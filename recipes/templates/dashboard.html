{% extends 'base_content.html' %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col-12">
      <h1>Welcome to your dashboard {{ user.username }}</h1>

       <div class="mt-4 d-flex align-items-center gap-3 flex-wrap">
          <a href="{% url 'create_recipe' %}" class="btn btn-primary btn-lg me-3">
            Create New Recipe
          </a>
          <a href="{% url 'user_recipes' %}" class="btn btn-secondary btn-lg">
            My Recipes
          </a>

          <!-- Time Filter-->
          <a class="btn btn-primary dropdown-toggle" href="#" id="time-filter-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Sort by Time
          </a>
          <ul class="dropdown-menu" aria-labelledby="time-filter-dropdown">
            <li><a class="dropdown-item" href="{% url 'dashboard' %}?max_time=20">20 mins or Less</a></li>
            <li><a class="dropdown-item" href="{% url 'dashboard' %}?max_time=45">45 mins or Less</a></li>
            <li><a class="dropdown-item" href="{% url 'dashboard' %}?max_time=60">60 mins or Less</a></li>
            <li><a class="dropdown-item" href="{% url 'dashboard' %}?max_time=90">90 mins or Less</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{% url 'dashboard' %}?min_time=90">Over 90 mins</a></li>
            <li><a class="dropdown-item" href="{% url 'dashboard' %}">All Recipes</a></li>
          </ul>

          <!-- Search Form -->
          <form method="get" action="" class="d-flex ms-auto">
            <input 
            type="text"
            name="search"
            class="form-control me-2"
            style="min-width: 250px;"
            placeholder="Search recipe name..."
            value="{{request.GET.Search}}">
            <button type="submit" class = "btn btn-outline-primary btn-lg">
              Search
            </button>
          </form>
      </div>

      <h2 class="list-title mt-5">Explore Recipes from Others</h2>

      <!-- Meal Type Filter-->
      <form method="GET" class="mb-4">
        <label for="meal_type">Filter by meal type:</label>
        <select name="meal_type" id="meal_type" class="form-select" onchange="this.form.submit()">
          <option value="">All</option>
          <option value="breakfast" {% if selected_meal_type == "breakfast" %}selected{% endif %}>Breakfast</option>
          <option value="lunch" {% if selected_meal_type == "lunch" %}selected{% endif %}>Lunch</option>
          <option value="dinner" {% if selected_meal_type == "dinner" %}selected{% endif %}>Dinner</option>
          <option value="snack" {% if selected_meal_type == "snack" %}selected{% endif %}>Snack</option>
          <option value="dessert" {% if selected_meal_type == "dessert" %}selected{% endif %}>Dessert</option>
        </select>
      </form>

      
      {% if recipes %}
        <div class="list-group">
          {% for recipe in recipes %}
            <div class="list-group-item">
              <h5>{{ recipe.title }}</h5>
              <p class="low-key">{{ recipe.description|truncatewords:20 }}</p>
              <small class="text-muted">
                By {{ recipe.author.username }} | 
                Prep time: {{ recipe.time }} minutes | 
                Created: {{ recipe.created_at|date:"M d, Y" }}
              </small>
            </div>
          {% endfor %}
        </div>
      {% else %}
        {% if selected_meal_type %}
          <p class="low-key">
            No recipes of the requested meal type are available from other users yet.
          </p>
        {% else %}
          <p class="low-key">No recipes available from other users yet.</p>
        {% endif %}
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}