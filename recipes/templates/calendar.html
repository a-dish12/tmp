{% extends "base_content.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>My Meal Planner</h1>
  <a href="{% url 'dashboard' %}" class="btn btn-secondary">← Back to Dashboard</a>
</div>

<!-- Calendar container MUST have height -->
<div id="calendar" style="min-height: 700px;"></div>

<!-- FullCalendar CSS -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css"
/>

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const calendarEl = document.getElementById("calendar");

    if (!calendarEl) {
        console.error("Calendar element not found");
        return;
    }

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",

        headerToolbar: {
            left: "prevYear,prev,today,next,nextYear",
            center: "title",
            right: "dayGridMonth,timeGridWeek,timeGridDay,listWeek",
        },

        navLinks: true,
        selectable: true,
        nowIndicator: true,
        height: "auto",

        // Fetch events from Django
        events: "{% url 'planner_events' %}",

        // Click a day → go to planner day page
        dateClick: function(info) {
            const d = info.date;   // JS Date object (NOT string)

            const yyyy = d.getFullYear();
            const mm = String(d.getMonth() + 1).padStart(2, "0");
            const dd = String(d.getDate()).padStart(2, "0");

            const dateOnly = `${yyyy}-${mm}-${dd}`;

            const url = "{% url 'planner_day' 'YYYY-MM-DD' %}"
            .replace("YYYY-MM-DD", dateOnly);

            window.location.href = url;
        },
        eventClick: function(info) {
            // if the event JSON includes a `url`, FullCalendar can use it
            if (info.event.url) {
                window.location.href = info.event.url;
                info.jsEvent.preventDefault();
            }
        },
    });

    calendar.render();
  });
</script>

{% endblock %}
