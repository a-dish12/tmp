{% extends 'base_content.html' %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col-lg-8">
      <!-- Recipe Info -->
      <h1>{{ recipe.title }}</h1>
      <p class="text-muted">
        By {{ recipe.author.full_name }} ({{ recipe.author.username }}) | 
        <!-- {{ recipe.created_at|date:"F d, Y" }} -->
      </p>
      
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Description</h5>
          <p>{{ recipe.description }}</p>
          
          <h5 class="card-title mt-4">Details</h5>
          <ul class="list-unstyled">
            <li><strong>Prep Time:</strong> {{ recipe.time }} minutes</li>
            <li><strong>Meal Type:</strong> {{ recipe.meal_type|capfirst }}</li>
          </ul>
          
          <h5 class="card-title mt-4">Ingredients</h5>
          <pre class="bg-light p-3 rounded">{{ recipe.ingredients }}</pre>
        </div>
      </div>
      
      <!-- Back Button -->
      <a href="{% url 'dashboard' %}" class="btn btn-secondary">← Back to Dashboard</a>
    </div>
    
    <div class="col-lg-4">
      <!-- Rating Section -->
      <div class="card sticky-top" style="top: 20px;">
        <div class="card-body">
          <h5 class="card-title">Recipe Rating</h5>
          
          <!-- Average Rating Display -->
          <div class="text-center mb-3">
            <div class="rating-stars-large">
              {% with avg=recipe.average_rating %}
                {% for i in "12345" %}
                  <span class="{% if forloop.counter <= avg %}text-warning{% else %}text-muted{% endif %}" style="font-size: 2rem;">★</span>
                {% endfor %}
              {% endwith %}
            </div>
            <p class="mt-2 mb-0">
              <strong>{{ recipe.average_rating|floatformat:1 }}</strong> out of 5
            </p>
            <small class="text-muted">{{ recipe.rating_count }} rating{{ recipe.rating_count|pluralize }}</small>
          </div>
          
          <hr>
          
          <!-- Rating Form -->
          {% if recipe.author == user %}
            <p class="text-muted text-center">You cannot rate your own recipe.</p>
          {% elif not user.is_authenticated %}
            <p class="text-muted text-center">
              <a href="{% url 'log_in' %}">Log in</a> to rate this recipe.
            </p>
          {% else %}
            {% if user_rating %}
              <p class="text-center text-success mb-2">
                You rated this: {{ user_rating }} star{{ user_rating|pluralize }}
              </p>
              <p class="text-muted text-center small">Submit again to update your rating</p>
            {% else %}
              <p class="text-center mb-2"><strong>Rate this recipe:</strong></p>
            {% endif %}
            
            <form method="post" action="{% url 'rate_recipe' recipe_pk=recipe.pk %}">
              {% csrf_token %}
              <div class="d-flex justify-content-center gap-2 mb-3">
                {% for i in "12345" %}
                  <label class="star-rating-label">
                    <input type="radio" name="stars" value="{{ forloop.counter }}" required 
                           {% if user_rating == forloop.counter %}checked{% endif %}>
                    <span class="star-rating-icon">★</span>
                    <span class="visually-hidden">{{ forloop.counter }} star{{ forloop.counter|pluralize }}</span>
                  </label>
                {% endfor %}
              </div>
              <button type="submit" class="btn btn-primary w-100">Submit Rating</button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}