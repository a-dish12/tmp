{% load static %}
<div class="comment-item" data-depth="{{ depth }}" style="--depth: {{ depth }};">
  <div class="comment-wrapper {% if depth > 0 %}comment-reply{% endif %}">
    <!-- Thread line for replies -->
    {% if depth > 0 %}
    <div class="thread-line"></div>
    {% endif %}
    
    <div class="comment-content">
      <div class="comment-header d-flex justify-content-between align-items-start">
        <div>
          <strong>
            <a href="{% url 'user_profile' user_id=comment.user.id %}">{{ comment.user.username }}</a>
          </strong>
          <small class="text-muted ms-2">{{ comment.created_at|timesince }} ago</small>
        </div>
        
        <!-- Delete button for comment author -->
        {% if comment.user == user %}
        <form method="post" action="{% url 'delete_comment' comment.pk %}" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-link text-danger p-0" 
                  onclick="return confirm('Delete this comment?')">
            Delete
          </button>
        </form>
        {% endif %}
      </div>
      
      <div class="comment-text mt-2">
        {{ comment.text }}
      </div>
      
      <!-- Reply button -->
      {% if user.is_authenticated and depth < 5 %}
      <div class="comment-actions mt-2">
        <button class="btn btn-sm btn-link p-0 text-decoration-none reply-btn" 
                data-comment-id="{{ comment.id }}">
          ↩️ Reply
        </button>
      </div>
      
      <!-- Reply form (hidden by default) -->
      <div class="reply-form-container mt-2" id="reply-form-{{ comment.id }}" style="display: none;">
        <form method="post" action="{% url 'add_reply' comment.pk %}">
          {% csrf_token %}
          <textarea name="text" class="form-control" rows="2" 
                    placeholder="Write your reply..." required></textarea>
          <div class="mt-2">
            <button type="submit" class="btn btn-sm btn-primary">Post Reply</button>
            <button type="button" class="btn btn-sm btn-secondary cancel-reply" 
                    data-comment-id="{{ comment.id }}">Cancel</button>
          </div>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
  
  <!-- Nested Replies -->
  {% if comment.replies.all %}
  <div class="comment-replies">
    {% for reply in comment.replies.all %}
      {% include 'partials/comment.html' with comment=reply depth=depth|add:1 %}
    {% endfor %}
  </div>
  {% endif %}
</div>
