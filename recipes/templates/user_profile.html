{% extends 'base_content.html' %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-12">
        <h1> {{ profile_user.full_name}} {{ profile_user.username }} </h1>

        <p>
            <a href="{% url 'user_followers' profile_user.id %}">
                Followers: {{ followers_count }}
            </a>
            |
            <a href="{% url 'user_following' profile_user.id %}">
                Following: {{ following_count }}
            </a>
        </p>

        
        {% if user.is_authenticated and user.id != profile_user.id %}
            {% if is_following %}
                <form method="post" action="{% url 'unfollow_user' profile_user.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger">Unfollow</button>
                </form>

            {% elif request_pending %}
                <form method="post" action="{% url 'cancel_follow_request' profile_user.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-secondary">Requested (Cancel)</button>
                </form>

            {% else %}
                <form method="post" action="{% url 'follow_user' profile_user.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">
                        {% if profile_user.is_private %}Request to Follow{% else %}Follow{% endif %}
                    </button>
                </form>
            {% endif %}
        {% endif %}
        
        <hr> 

        {% if user.is_authenticated and user.id != profile_user.id %}
            {% if incoming_request %}
                <p class="mt-2">{{ profile_user.username }} has sent you a friend request.</p>
                <form method="post" action="{% url 'accept_friend_request' incoming_request.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm">Accept</button>
                </form>
                <form method="post" action="{% url 'reject_friend_request' incoming_request.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-secondary btn-sm">Reject</button>
                </form>

            {% elif outgoing_request %}
                <p class="mt-2">Friend request pending </p>
                 <form method="post" action="{% url 'cancel_follow_request' profile_user.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-secondary">Requested (Cancel)</button>
                </form>
            {% endif %}
        {% endif %}

        <hr>

    {% if user.is_authenticated and user.id == profile_user.id %}
        <h3>Follow requests</h3>
        {% if incoming_follow_requests %}
            <ul class="list-group">
                {% for fr in incoming_follow_requests %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="{% url 'user_profile' fr.from_user.id %}">
                            {{ fr.from_user.username }}
                        </a>
                        <div>
                            <form method="post" action="{% url 'accept_follow_request' fr.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success btn-sm">Accept</button>
                            </form>
                            <form method="post" action="{% url 'reject_follow_request' fr.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-secondary btn-sm">Reject</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No pending friend requests.</p>
        {% endif %}
    {% endif %}

        <p> user content </p>
    
        <a href="{% url 'dashboard' %}" class="btn btn-secondary mt-3">‚Üê Back to Dashboard</a>
    </div>
  </div>
</div>

{% endblock %}
